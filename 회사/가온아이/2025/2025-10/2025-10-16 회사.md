#2025-10-16 #2025-10 #2025- 
#회사 #점심 #도시락

------
# 링크 


---
## 오늘의 할 일
- [x] AD에 부서 OU 안에 부서 개체 생성
    - [x] 회사, 부서 수정시 삭제 후 생성, 부분 업데이트 중에 부분 업데이트로 결정
    - [x] 부서 수정 기능 완료
- [ ] 직위, 직급 생성
    - [ ] TBLTitleMaster, TBLPositionMaster
- [ ] 직위, 직급 수정
---
## 회의 메모
- 
---
## 오늘 배운 것
1. 오전
    1. 
2. 오후
    1. 
---
## Next Day 해야할 일
1. 


## 있었던 일 or 메모

```sql
CREATE PROCEDURE [dbo].[EZSP_SETDEPT2]

(

@pXml XML,

@pMail NVARCHAR(50),

@pADSPath NVARCHAR(200),

@pType VARCHAR(10) -- I : 생성, U : 수정

)

AS

BEGIN

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;

SET NOCOUNT ON;

  

DECLARE @CN VARCHAR(50);

DECLARE @DisplayName NVARCHAR(200);

DECLARE @DisplayName2 NVARCHAR(200);

DECLARE @DisplayName3 NVARCHAR(200);

DECLARE @DisplayName4 NVARCHAR(200);

DECLARE @DisplayName5 NVARCHAR(200);

DECLARE @DisplayName6 NVARCHAR(200);

DECLARE @DisplayName7 NVARCHAR(200);

DECLARE @UseFlag CHAR(1);

DECLARE @CompanyID VARCHAR(50);

DECLARE @WorkPlaceID VARCHAR(50);

DECLARE @ExtensionAttribute1 NVARCHAR(200); -- 상위부서ID

DECLARE @ExtensionAttribute6 NVARCHAR(200); -- 부서약어

DECLARE @ExtensionAttribute9 NVARCHAR(200);

DECLARE @ExtensionAttribute11 CHAR(1); -- 결재문서수신

DECLARE @ExtensionAttribute15 NVARCHAR(200); -- 정렬순서

DECLARE @ADFlag CHAR(1);

DECLARE @UserID VARCHAR(50); -- 작성/수정자ID

  

SELECT

@CN = x.y.value('CN[1]', 'VARCHAR(50)'),

@DisplayName = x.y.value('DISPLAYNAME[1]', 'NVARCHAR(200)'),

@DisplayName2 = x.y.value('DISPLAYNAME2[1]', 'NVARCHAR(200)'),

@DisplayName3 = x.y.value('DISPLAYNAME3[1]', 'NVARCHAR(200)'),

@DisplayName4 = x.y.value('DISPLAYNAME4[1]', 'NVARCHAR(200)'),

@DisplayName5 = x.y.value('DISPLAYNAME5[1]', 'NVARCHAR(200)'),

@DisplayName6 = x.y.value('DISPLAYNAME6[1]', 'NVARCHAR(200)'),

@DisplayName7 = x.y.value('DISPLAYNAME7[1]', 'NVARCHAR(200)'),

@UseFlag = x.y.value('USEFLAG[1]', 'CHAR(1)'),

@CompanyID = x.y.value('COMPANYID[1]', 'VARCHAR(50)'),

@WorkPlaceID = x.y.value('WORKPLACEID[1]', 'VARCHAR(50)'),

@ExtensionAttribute1 = x.y.value('PARENTCN[1]', 'NVARCHAR(200)'),

@ExtensionAttribute6 = x.y.value('EXTENSIONATTRIBUTE6[1]', 'NVARCHAR(200)'),

@ExtensionAttribute9 = x.y.value('EXTENSIONATTRIBUTE9[1]', 'NVARCHAR(200)'),

@ExtensionAttribute11 = x.y.value('EXTENSIONATTRIBUTE11[1]', 'CHAR(1)'),

@ExtensionAttribute15 = x.y.value('EXTENSIONATTRIBUTE15[1]', 'NVARCHAR(200)'),

@ADFlag = x.y.value('ADFLAG[1]', 'CHAR(1)'),

@UserID = x.y.value('USERID[1]', 'VARCHAR(50)')

FROM @pXml.nodes('DATA') AS x(y);

  

-- 부서 생성

IF (@pType = 'I')

BEGIN

DECLARE @ExtensionAttribute3 NVARCHAR(200); -- 회사명

DECLARE @CompNm2 NVARCHAR(200);

DECLARE @CompNm3 NVARCHAR(200);

DECLARE @CompNm4 NVARCHAR(200);

DECLARE @CompNm5 NVARCHAR(200);

DECLARE @CompNm6 NVARCHAR(200);

DECLARE @CompNm7 NVARCHAR(200);

DECLARE @WorkPlaceName NVARCHAR(200);

DECLARE @WorkPlaceName2 NVARCHAR(200);

DECLARE @WorkPlaceName3 NVARCHAR(200);

DECLARE @WorkPlaceName4 NVARCHAR(200);

DECLARE @WorkPlaceName5 NVARCHAR(200);

DECLARE @WorkPlaceName6 NVARCHAR(200);

DECLARE @WorkPlaceName7 NVARCHAR(200);

DECLARE @DeptLevel VARCHAR(3);

DECLARE @Dept_CD_Path NVARCHAR(200);

DECLARE @Dept_Nm_Path NVARCHAR(200);

  

-- 회사정보

SELECT

@ExtensionAttribute3 = DisplayName,

@CompNm2 = DisplayName2,

@CompNm3 = DisplayName3,

@CompNm4 = DisplayName4,

@CompNm5 = DisplayName5,

@CompNm6 = DisplayName6,

@CompNm7 = DisplayName7

FROM TBLDeptMaster WITH (NOLOCK)

WHERE CN = @CompanyID;

  

-- 사업장 정보

SELECT

@WorkPlaceName = DisplayName,

@WorkPlaceName2 = DisplayName2,

@WorkPlaceName3 = DisplayName3,

@WorkPlaceName4 = DisplayName4,

@WorkPlaceName5 = DisplayName5,

@WorkPlaceName6 = DisplayName6,

@WorkPlaceName7 = DisplayName7

FROM TBLWorkPlaceMaster WITH (NOLOCK)

WHERE CN = @WorkPlaceID;

  

-- 상위부서 정보

SELECT

@DeptLevel = CONVERT(VARCHAR, CONVERT(INT, DeptLevel) + 1),

@Dept_CD_Path = Dept_CD_Path + ',' + @CN,

@Dept_Nm_Path = Dept_Nm_Path + ',' + @DisplayName,

@ExtensionAttribute3 = extensionAttribute3,

@CompNm2 = CompNm2

FROM TBLDeptMaster WITH (NOLOCK)

WHERE CN = @ExtensionAttribute1;

  

-- 부서 생성

INSERT INTO TBLDeptMaster

(

CN, DisplayName, DisplayName2, DisplayName3, DisplayName4, DisplayName5, DisplayName6, DisplayName7,

UseFlag, mail, CompNm2, CompNm3, CompNm4, CompNm5, CompNm6, CompNm7,

DeptLevel, Dept_CD_Path, Dept_Nm_Path,

extensionAttribute1, extensionAttribute2, extensionAttribute3, extensionAttribute6, extensionAttribute9,

extensionAttribute11, extensionAttribute15, ADFlag, ADSPath,

WorkPlaceID, WorkPlaceName, WorkPlaceName2, WorkPlaceName3, WorkPlaceName4,

WorkPlaceName5, WorkPlaceName6, WorkPlaceName7, CreateDT, CreateUserID

)

VALUES

(

@CN, @DisplayName, @DisplayName2, @DisplayName3, @DisplayName4, @DisplayName5, @DisplayName6, @DisplayName7,

@UseFlag, @pMail, @CompNm2, @CompNm3, @CompNm4, @CompNm5, @CompNm6, @CompNm7,

@DeptLevel, @Dept_CD_Path, @Dept_Nm_Path,

@ExtensionAttribute1, @CompanyID, @ExtensionAttribute3, @ExtensionAttribute6, @ExtensionAttribute9,

@ExtensionAttribute11, @ExtensionAttribute15, @ADFlag, @pADSPath,

@WorkPlaceID, @WorkPlaceName, @WorkPlaceName2, @WorkPlaceName3, @WorkPlaceName4,

@WorkPlaceName5, @WorkPlaceName6, @WorkPlaceName7, GETDATE(), @UserID

);

END

ELSE IF (@pType = 'U')

BEGIN

-- 부서 수정

UPDATE TBLDeptMaster

SET

DisplayName = ISNULL(@DisplayName, DisplayName),

DisplayName2 = ISNULL(@DisplayName2, DisplayName2),

UseFlag = ISNULL(@UseFlag, UseFlag),

mail = ISNULL(@pMail, mail),

ADSPath = ISNULL(@pADSPath, ADSPath),

extensionAttribute1 = ISNULL(@ExtensionAttribute1, extensionAttribute1),

extensionAttribute2 = ISNULL(@CompanyID, extensionAttribute2),

WorkPlaceID = ISNULL(@WorkPlaceID, WorkPlaceID),

UpdateDT = GETDATE(),

UpdateUserID = @UserID

WHERE CN = @CN;

END

END
```

# 처리 못한일